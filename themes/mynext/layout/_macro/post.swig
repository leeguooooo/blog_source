{% macro render(post, is_index, post_extra_class) %}
  <article class="post post-type-{{ post.type | default('normal') }} {{ post_extra_class | default('') }}" itemscope itemtype="http://schema.org/Article">

    <header class="post-header">
      <input type="text" id="post_title" value="{{ post.title }}" hidden/>
      {# Not to show title for quote posts that do not have a title #}
      {% if not (is_index and post.type === 'quote' and not post.title) %}
        <h1 class="post-title" itemprop="name headline">
          {# Link posts #}
          {% if post.link %}
            <a class="post-title-link post-title-link-external" target="_blank" href="{{ url_for(post.link) }}" itemprop="url">
              {{ post.title or post.link }}
              <i class="icon-external-link"></i>
            </a>
          {% else %}
            {% if is_index %}
              <a class="post-title-link" href="{{ url_for(post.path) }}" itemprop="url">
                {{ post.title | default(__('post.untitled'))}}
              </a>
            {% else %}
              {{ post.title }}
            {% endif %}
          {% endif %}
        </h1>
      {% endif %}

      <div class="post-meta">
        {% if post.top %}
        <span class="post-top">{{ __('post.top') }}</span>
        {% endif %}
        <span class="post-time">
          <!-- {{ __('post.posted') }} -->
          <span class="iconfont">&#xf19f;</span>
          <time itemprop="dateCreated" datetime="{{ moment(post.date).format() }}" content="{{ date(post.date, config.date_format) }}">
            {{ date(post.date, config.date_format) }}
          </time>
        </span>

        {% if post.author %}
        <span class="post-time">
          &nbsp; | &nbsp;
          <span class="iconfont">&#xf024;</span>
          <a href="/authors/{{ post.author }}/">{{ post.author }}</a>
        </span>
        {% endif %}

        {% if post.categories and post.categories.length %}
          <span class="post-category" >
            &nbsp; | &nbsp;
            <!-- {{ __('post.in') }} -->
            <span class="iconfont">&#xf1d0;</span>
            {% for cat in post.categories %}
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="{{ url_for(cat.path) }}" itemprop="url" rel="index">
                  <span itemprop="name">{{ cat.name }}</span>
                </a>
              </span>

              {% set cat_length = post.categories.length %}
              {% if cat_length > 1 and loop.index !== cat_length %}
                {{ __('symbol.comma') }}
              {% endif %}

            {% endfor %}
          </span>
        {% endif %}

        {% if post.comments %}
          {% if (theme.duoshuo and theme.duoshuo.shortname) or theme.duoshuo_shortname %}
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="{{ url_for(post.path) }}#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="{{ post.path }}" itemprop="commentsCount"></span>
              </a>
            </span>
          {% elseif theme.disqus_shortname %}
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="{{ url_for(post.path) }}#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="{{ post.path }}" itemprop="commentsCount"></span>
            </a>
          </span>
          {% endif %}
        {% endif %}

        {% if theme.leancloud_visitors.enable %}
        	 <span id="{{ url_for(post.path) }}"class="leancloud_visitors"  data-flag-title="{{ post.title }}">
                &nbsp; | &nbsp;
                {{__('<span class="iconfont">&#xf03a;</span>')}}
                </span>人
        {% endif %}


      <!--  <span class="post-comments-count">
          &nbsp; | &nbsp;
          <a class="cloud-tie-join-count" href="javascript:void(0);">
           <span id="busuanzi_value_site_uv" class="join-count" style="color:black">0</span>
           <span class="join-text">人阅读</span>
         </a>
        </span>-->

        {% if not is_index %}
        <span class="post-comments-count">
          <!-- 暂不支持评论 &nbsp; | &nbsp;
          <a class="cloud-tie-join-count" href="javascript:void(0);">
           <span class="join-count" style="color:black">0</span>
           <span class="join-text">人评论</span>
         </a> -->
         {% endif %}
        </span>
      </div>
      {% if !is_index && config.authors[page.author] %}
      <blockquote class="blockquote-center">
        <p style="padding: 0 50px">{{page.author}}，{{ config.authors[page.author] || '' }}</p>
      </blockquote>
      {% endif %}


    </header>

    <div class="post-body">

      {# Gallery support #}
      {% if post.photos and post.photos.length and is_index %}
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          {% set COLUMN_NUMBER = 3 %}
          {% for photo in post.photos %}
            {% if loop.index0 % COLUMN_NUMBER === 0 %}<div class="post-gallery-row">{% endif %}
              <a class="post-gallery-img fancybox"
                 href="{{ url_for(photo) }}" rel="gallery_{{ post._id }}"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="{{ url_for(photo) }}" itemprop="contentUrl" style="max-height: 300px"/>
              </a>
            {% if loop.index0 % COLUMN_NUMBER === 2 %}</div>{% endif %}
          {% endfor %}

          {# Append end tag for `post-gallery-row` when (photos size mod COLUMN_NUMBER) is less than COLUMN_NUMBER #}
          {% if post.photos.length % COLUMN_NUMBER > 0 %}</div>{% endif %}
        </div>
      {% endif %}

      {% if is_index %}
        {% if post.description %}
          <span itemprop="description">{{ post.description }}</span>
          <div class="post-more-link text-center">
            <a class="btn" href="{{ url_for(post.path) }}">
              {{ __('post.read_more') }} &raquo;
            </a>
          </div>
        {% elif post.excerpt  %}
          {{ post.excerpt }}
          <div class="post-more-link text-center">
            <a class="btn" href="{{ url_for(post.path) }}{% if theme.scroll_to_more %}#more{% endif %}" rel="contents">
              {{ __('post.read_more') }} &raquo;
            </a>
          </div>
        {% elif theme.auto_excerpt.enable %}
          <span itemprop="articleBody">
            {% set content = post.content | striptags %}
            {{ content.substring(0, theme.auto_excerpt.length) }}
            {% if content.length > theme.auto_excerpt.length %}...{% endif %}
          </span>
          <div class="post-more-link text-center">
            <a class="btn" href="{{ url_for(post.path) }}{% if theme.scroll_to_more %}#more{% endif %}" rel="contents">
              {{ __('post.read_more') }} &raquo;
            </a>
          </div>
        {% else %}
          <span itemprop="articleBody">{{ post.content }}</span>
        {% endif %}
      {% else %}
        <span itemprop="articleBody">{{ post.content }}</span>
      {% endif  %}
    </div>
    <footer class="post-footer">
      {% if post.tags and post.tags.length and not is_index %}
        <div class="post-tags">
          {% for tag in post.tags %}
            <a href="{{ url_for(tag.path) }}" rel="tag">#{{ tag.name }}</a>
          {% endfor %}
        </div>
      {% endif %}

      {% if not is_index and (post.prev or post.next) %}
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            {% if post.prev %}
              <a href="{{ url_for(post.prev.path) }}" rel="prev">{{post.prev.title}}</a>
            {% endif %}
          </div>

          <div class="post-nav-next post-nav-item">
            {% if post.next %}
              <a href="{{ url_for(post.next.path) }}" rel="next">{{post.next.title}}</a>
            {% endif %}
          </div>
        </div>

        <div class ="post-donate">
            <div id="donate_board" class="donate_bar center">
                <a id="btn_donate" class="btn_donate" href="javascript:;" title="谢谢您请我吃糖~"></a>
                <span class="donate_txt">
                   <br>坚持原创技术分享，您的支持将鼓励我继续创作！
                </span>
                <br>
              </div>
        	<div id="donate_guide" class="donate_bar center hidden" >
        		<!-- 微信打赏图案 -->
        		<img src="/images/shang2.png" alt="谢谢您请我吃糖~ 一定要留下大名啊">
            </div>
        	<script type="text/javascript">
        		document.getElementById('btn_donate').onclick = function(){
        			$('#donate_board').addClass('hidden');
        			$('#donate_guide').removeClass('hidden');
        		}
        	</script>
        </div>

        {# <div id="container"></div> #}
        <div id="gitalk-container"></div>
        {# <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"> #}
        {# <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script> #}
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
        <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
        <script>
        var gitalk = new Gitalk({
          id: document.getElementById('post_title').value, // 可选。默认为 location.href
          clientID: 'df4b56c0c784b50449a2',
          clientSecret: '272d603a2eb298930f8c20b76aed0570400b4095',
          owner: 'leeguooooo',
          repo: 'shuoshuo',
          admin: ['leeguooooo'],
          language: 'zh-CN',
        });

        gitalk.render('gitalk-container')
        // var gitment = new Gitment({
        //   id: document.getElementById('post_title').value, // 可选。默认为 location.href
        //   owner: 'leeguooooo',
        //   repo: 'shuoshuo',
        //   oauth: {
        //     client_id: 'df4b56c0c784b50449a2',
        //     client_secret: '272d603a2eb298930f8c20b76aed0570400b4095',
        //   },
        // })
        // gitment.render('container')
        </script>
      {% endif %}

      {% set isLast = loop.index % page.per_page === 0 %}
      {% if is_index and not isLast %}
        <div class="post-eof"></div>
      {% endif %}
    </footer>

  </article>
{% endmacro %}
